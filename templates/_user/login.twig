{% extends '_layout' %}

{% set pageTitle = 'Sign in'|t('app') %}

{% block content %}
	{% if getCookie('pin') %}
        {% redirect "progress" %}
	{% else %}
		<section class="feature static">
			<div class="wrap">
				<div bp="grid vertical-center">
					<div bp="12" class="content">
						<h1>Login</h1>
					</div>
				</div>
			</div>
		</section>
		<section class="section halfbottom register login">
			<div class="wrap">
				<div bp="grid vertical-center text-center" class="mx-lg-n5 account">
					{% if craft.app.session.getFlash('notice') == 'Password reset email sent.'|t %}
					<div bp="10@lg offset-2@lg text-center" class="success">
						<h4 class="p-0">Your request has been received, please check your email for further instructions.</h4>
					</div>
					{% endif %}
					<div bp="5@md offset-2@md" class="box">
						<form action="" name="frmlogin" id="frmlogin" method="post">		
							<label for="pincode">Nursery Login:</label>
							<input type="text" id="pincode" name="pincode">	
						</form>
					</div>
					<div bp="5@md" class="box">
						<h2 class="pt-0">Parent Login</h2>
						<div class="form-fields">
                        	<div class="message"></div>
							<form method="post" accept-charset="UTF-8" id="signForm">
								{{ csrfInput() }}
								{{ actionInput('users/login') }}

								<div>
									{{ input('email', 'loginName', craft.app.user.rememberedUsername, {
										id: 'loginName',
										placeholder: 'Email Address',
										autocomplete: 'username',
										class: 'input required',
									}) }}
									<label for="loginName">Email Address</label>
								</div>

								<div>
									{{ input('password', 'password', null, {
										id: 'password',
										placeholder: 'Password',
										class: 'input required',
									}) }}
									<label for="password">Password</label>
									<span toggle="#password" class="fa-sharp fa-solid fa-eye toggle-password"></span>
								</div>

								<div bp="grid vertical-center" class="mt-3">
									<div bp="5@lg text-left">
										<button class="btn brandbg4 whitetext stroke decal caps rounded" id="submit2">Login</button>
									</div>
									<div bp="7@lg text-right">
										<a href="#" data-hystmodal="#modal" class="forgot white">Forgotten your password?</a>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>
		<div class="hystmodal" id="modal" aria-hidden="true">
            <div class="hystmodal__wrap">
                <div class="hystmodal__window" role="dialog" aria-modal="true">
                    <div class="hystmodal__content">
                        <button data-hystclose class="hystmodal__close">Close</button>
                        <h2 class="h4">Reset your password</h2>
						<p>We will send you an email to reset your password. You will need to create an account before you're able to reset your password. If you enter an email address that hasn't been registered you won't receive any instructions.</p>
						<form method="post" accept-charset="UTF-8" id="forgotForm">
							{{ csrfInput() }}
							{{ actionInput('users/send-password-reset-email') }}

							<div class="relative">
								{{ input('email', 'loginName', loginName ?? craft.app.user.rememberedUsername, {
									id: 'loginName2',
									placeholder: 'Email Address',
									autocomplete: 'username',
									class: 'input',
									required: 'required',
								}) }}
								<label for="loginName2">Email Address</label>
							</div>

							<button class="btn brandbg whitetext stroke decal caps rounded fullwidth mt-2">Submit</button>
						</form>
                    </div>
                </div>
            </div>
        </div>
		{% include "_includes/prize-banner.twig" %}
		{% include "_includes/cta.twig" %}
		{% include "_includes/blog-listing.twig" with { posts: craft.entries().section('blog').limit(1).all() } only %}
    {% endif %}
            
	{% js %}
		$(document).ready(function(){

			$('#signForm').on('submit', function(e) {
				e.preventDefault();
				var formData = $(this).serialize();
				var btn = $('.btn', this);
				$('.message').html('');
				btn.html('<i class="fa-solid fa-fan fa-spin fa-lg"></i>').addClass('spin-on');
				$.ajax({
					type:'POST',
					url: '/',
					dataType: 'json',
					data: formData,
					contentType: "application/x-www-form-urlencoded",
					success: function(result) {
						window.location.href = '/account';
					},
					error: function(result) {
						$('.message').html('<span>' + result.responseJSON.message + '</span>');
						btn.html('Login').removeClass('spin-on');
					}
				});
			});
			
		});
        const myModal = new HystModal({
            linkAttributeName: "data-hystmodal",
        });
{% endjs %}
{% endblock %}